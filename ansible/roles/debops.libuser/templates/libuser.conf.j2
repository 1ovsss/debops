# {{ ansible_managed }}

{% for element in libuser__combined_configuration | parse_kv_items %}
{%   if element.name|d() and element.state|d('present') not in [ 'absent', 'ignore' ] %}

{%     if element.name %}
{{ '[{}]'.format(element.name) }}
{%     endif %}
{%       if element.options|d() %}
{%         for thing in element.options %}
{%           set thing_dict = {'name': (thing.thing | d(thing.name)), 'state': thing.state|d('present'), 'value': thing.value|d(), 'comment': thing.comment|d() } %}
{%           if thing.name|d() and thing.value|d() and thing.state|d('present') and thing.comment|d() != 'absent' %}
{%                 set _ = thing_dict.update({ 'name': thing.name|string }) %}
{%                 set _ = thing_dict.update({ 'value': thing.value|string }) %}
{%                 set thing_commented = ('#' if thing.state|d('present') == 'comment' else '') %}
{% if thing.comment|d() %}
{{ "{} {}".format('#', (thing.comment) if (thing.comment|d()) else '') }}
{% endif %}
{{ '{} {} = {}'.format(thing_commented, thing.name, ([ thing.value ] if thing.value is string else thing.value) | join(',')) }}
{% else %}
{{ '{} = {}'.format(thing.name, thing.value) }}
{%           endif %}
{%         endfor %}
{%       endif %}
{%     endif %}
{% endfor %}
