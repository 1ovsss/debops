---
# .. vim: foldmarker=[[[,]]]:foldmethod=marker

# .. _roundcube__ref_defaults:

# debops.roundcube default variables [[[
# ======================================

# .. contents:: Sections
#    :local:
#
# .. include:: ../../../../includes/global.rst


# Packages and installation [[[
# -----------------------------

# .. envvar:: roundcube__required_php_packages [[[
#
# List of PHP packages required by Roundcube.
# Refer to the `official Roundcube documentation <https://github.com/roundcube/roundcubemail/wiki/Install-Requirements>`__ for details.
roundcube__required_php_packages:
  - 'iconv'
  - 'openssl'
  - 'session'
  - 'sockets'
  - 'xml'
  # Included in the xml package
  #- 'dom'
  - 'mbstring'
  - 'json'

                                                                   # ]]]
# .. envvar:: roundcube__optional_php_packages [[[
#
# List of recommended/optional PHP packages for Roundcube.
# Refer to the `official Roundcube documentation <https://github.com/roundcube/roundcubemail/wiki/Install-Requirements>`__ for details.
roundcube__optional_php_packages:
  - 'fileinfo'
  - 'pspell'
  - 'zip'

                                                                   # ]]]
# .. envvar:: roundcube__custom_php_packages [[[
#
# List of user defined PHP packages for Roundcube.
roundcube__custom_php_packages: []

                                                                   # ]]]
# .. envvar:: roundcube__base_php_packages [[[
#
# List of base PHP packages required by Roundcube.
roundcube__base_php_packages:
  - '{{ roundcube__required_php_packages }}'
  - '{{ roundcube__apt_php_packages }}'
  - '{{ roundcube__optional_php_packages }}'
  - '{{ [ "mysql" ] if (roundcube__database_map[roundcube__database].dbtype == "mysql") else [] }}'
  - '{{ [ "sqlite3" ] if (roundcube__database_map[roundcube__database].dbtype == "sqlite") else [] }}'

                                                                   # ]]]
# .. envvar:: roundcube__apt_php_packages [[[
#
# PHP packages which are installed via APT repository if they are available
# in a sufficiently new version in the current distribution. The required
# minimal versions are taken from the file:`composer.json.dist` of the Roundcube
# 1.3.0 release. If you install an older version of Roundcube you may want
# to adjust this list.
roundcube__apt_php_packages: '{{ [ "mail-mime", "net-smtp", "pear" ]
                                 if ansible_distribution_release in [ "stretch", "buster", "sid", "xenial", "yakkety", "zesty", "artful" ]
                                 else [] }}'

                                                                   # ]]]
# .. envvar:: roundcube__packages [[[
#
# List of additional APT packages (e.â€¯g. language dictionaries) that should
# be installed with Roundcube.
roundcube__packages: []

                                                                   # ]]]
# .. envvar:: roundcube__base_packages [[[
#
# APT packages required for the Roundcube installation.
roundcube__base_packages: [ 'curl', 'file', 'unzip' ]
                                                                   # ]]]
                                                                   # ]]]
# Roundcube user account [[[
# --------------------------

# .. envvar:: roundcube__user [[[
#
# Roundcube system user account.
roundcube__user: 'roundcube'

                                                                   # ]]]
# .. envvar:: roundcube__group [[[
#
# Roundcube system user group.
roundcube__group: 'roundcube'

                                                                   # ]]]
# .. envvar:: roundcube__home [[[
#
# Path to the home directory of the Roundcube system account.
roundcube__home: '{{ (ansible_local.root.home
                       if (ansible_local|d() and ansible_local.root|d() and
                           ansible_local.root.home|d())
                       else "/var/local") + "/" + roundcube__user }}'

                                                                   # ]]]
# .. envvar:: roundcube__comment [[[
#
# The GECOS string set for the Roundcube account.
roundcube__comment: 'Roundcube Webmail'

                                                                   # ]]]
# .. envvar:: roundcube__shell [[[
#
# The default shell of the Roundcube account.
roundcube__shell: '/usr/sbin/nologin'
                                                                   # ]]]
                                                                   # ]]]
# Roundcube source and deployment [[[
# -----------------------------------

# .. envvar:: roundcube__git_repo [[[
#
# Roundcube source repository.
roundcube__git_repo: 'https://github.com/roundcube/roundcubemail.git'

                                                                   # ]]]
# .. envvar:: roundcube__git_dest [[[
#
# Roundcube source directory on the host.
roundcube__git_dest: '{{ roundcube__src + "/" + roundcube__git_repo.split("://")[1] }}'

                                                                   # ]]]
# .. envvar:: roundcube__git_version [[[
#
# Roundcube release tag to deploy.
roundcube__git_version: '1.4.1'

                                                                   # ]]]
# .. envvar:: roundcube__git_checkout [[[
#
# Default path where Roundcube source files will be deployed.
roundcube__git_checkout: '{{ roundcube__www + "/sites/" + roundcube__user + "/public" }}'

                                                                   # ]]]
# .. envvar:: roundcube__src [[[
#
# Base path for git bare repository with Roundcube source.
roundcube__src: '{{ (ansible_local.root.src
                      if (ansible_local|d() and ansible_local.root|d() and
                          ansible_local.root.src|d())
                      else "/usr/local/src") + "/" + roundcube__user }}'

                                                                   # ]]]
# .. envvar:: roundcube__www [[[
#
# Base web root directory for Roundcube website.
roundcube__www: '{{ ansible_local.nginx.www
                    if (ansible_local|d() and ansible_local.nginx|d())
                    else "/srv/www" }}'

                                                                   # ]]]
# .. envvar:: roundcube__webserver_user [[[
#
# Roundcube webserver user (needs read-only access to the website code).
roundcube__webserver_user: '{{ ansible_local.nginx.user
                              if (ansible_local|d() and
                                  ansible_local.nginx|d() and
                                  ansible_local.nginx.user|d())
                              else "www-data" }}'
                                                                   # ]]]
                                                                   # ]]]
# Database configuration [[[
# --------------------------

# .. envvar:: roundcube__database [[[
#
# Database definition to use from the :envvar:`roundcube__database_map`.
roundcube__database: 'sqlite-default'

                                                                   # ]]]
# .. envvar:: roundcube__database_user [[[
#
# Database user account to use for Roundcube.
roundcube__database_user: 'roundcube'

                                                                   # ]]]
# .. envvar:: roundcube__database_password_path [[[
#
# Path to the database password file.
roundcube__database_password_path: '{{ secret + "/credentials/" + ansible_fqdn
                                       + "/roundcube/" + roundcube__database
                                       + "/" + roundcube__database_user + "/password" }}'

                                                                   # ]]]
# .. envvar:: roundcube__database_password [[[
#
# Database password for the account given in :envvar:`roundcube__database_user`.
roundcube__database_password: '{{ lookup("password", roundcube__database_password_path + " length=30") }}'

                                                                   # ]]]
# .. envvar:: roundcube__database_name [[[
#
# Name of the database to use for Roundcube.
roundcube__database_name: 'roundcubemail'

                                                                   # ]]]
# .. envvar:: roundcube__database_map [[[
#
# Database connection definitions. Selet the database connection to use in
# :envvar:`roundcube__database`.
roundcube__database_map:

  sqlite-default:
    dbtype: 'sqlite'
    dbname: 'db/roundcube.db'

  mysql-default:
    dbtype: 'mysql'
    dbname: '{{ roundcube__database_name }}'
    dbuser: '{{ roundcube__database_user }}'
    dbpass: '{{ roundcube__database_password }}'
    dbhost: 'localhost'
    dbtableprefix: ''

                                                                   # ]]]
# .. envvar:: roundcube__database_schema [[[
#
# Initial Roundcube database schema loaded by Ansible.
roundcube__database_schema: '{{ roundcube__git_checkout + "/SQL/mysql.initial.sql"
    if (roundcube__database_map[roundcube__database].dbtype == "mysql") else ""}}'
                                                                   # ]]]
                                                                   # ]]]
# Roundcube application options [[[
# ---------------------------------

# .. envvar:: roundcube__fqdn [[[
#
# The default DNS address of the RoundCube web application, used in the HTTP
# server configuration.
roundcube__fqdn: 'webmail.{{ roundcube__domain }}'

                                                                   # ]]]
# .. envvar:: roundcube__domain [[[
#
# The DNS domain of the RoundCube installation.
roundcube__domain: '{{ ansible_local.core.domain
                       if (ansible_local|d() and ansible_local.core|d() and
                           ansible_local.core.domain|d())
                       else ansible_domain }}'

                                                                   # ]]]
# .. envvar:: roundcube__imap_srv_rr [[[
#
# List which contains the result of the :command:`dig` query for IMAP server
# ``SRV`` resource records in the host's domain. See :rfc:`6186` for details.
roundcube__imap_srv_rr: '{{ q("dig", "_imaps._tcp." + roundcube__domain + "./SRV", "flat=0") }}'

                                                                   # ]]]
# .. envvar:: roundcube__imap_fqdn [[[
#
# The FQDN address of the IMAP server which stores user mailboxes. By default
# the host is located using DNS SRV resource records; if there are none, role
# checks if a local Dovecot installation is present and uses the host FQDN as
# the IMAP server address. Finally, the static ``imap.<domain>`` is used.
#
# Use of FQDN instead of ``localhost`` is required for X.509 certificate
# verification and for correct information in system logs.
roundcube__imap_fqdn: '{{ (roundcube__imap_srv_rr | selectattr("target", "defined")
                           | map(attribute="target")
                           | map("regex_replace", "\.$","")
                           | list | first)
                          if ("NXDOMAIN" not in roundcube__imap_srv_rr and
                              roundcube__imap_srv_rr[0])
                          else (ansible_fqdn
                                if (ansible_local|d() and ansible_local.dovecot|d() and
                                    (ansible_local.dovecot.installed|d())|bool)
                                else ("imap." + roundcube__domain)) }}'

                                                                   # ]]]
# .. envvar:: roundcube__imap_port [[[
#
# TCP port used for IMAP connections
roundcube__imap_port: '{{ (roundcube__imap_srv_rr | selectattr("target", "defined")
                           | map(attribute="port") | list | sort | first)
                          if ("NXDOMAIN" not in roundcube__imap_srv_rr and
                              roundcube__imap_srv_rr[0])
                          else "993" }}'

                                                                   # ]]]
# .. envvar:: roundcube__imap_server [[[
#
# The IMAP host chosen to perform the log-in.
# This variable is also called `default_server` by Roundcube  .
#
# Leave blank to show a textbox at login, give a list of hosts
# to display a pulldown menu or set one host as string.
# To use SSL/TLS connection, enter hostname with prefix ssl:// or tls://
# Supported replacement variables:
# %n - hostname ($_SERVER['SERVER_NAME'])
# %t - hostname without the first part
# %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)
# %s - domain name after the '@' from e-mail address provided at login screen
# For example %n = mail.domain.tld, %t = domain.tld
roundcube__imap_server: '{{ ("ssl://"
                             if (roundcube__imap_port == "993")
                             else ("tls://"
                                   if (roundcube__imap_port == "143")
                                   else "tls://"))
                             + roundcube__imap_fqdn }}'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_srv_rr [[[
#
# List which contains the result of the :command:`dig` query for SMTP
# (submission) server ``SRV`` resource records in the host's domain. See
# :rfc:`6186` for details.
roundcube__smtp_srv_rr: '{{ q("dig", "_submissions._tcp." + roundcube__domain + "./SRV", "flat=0") }}'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_fqdn [[[
#
# The FQDN address of the SMTP (submission) server which will be used to send
# e-mail messages. By default the host is located using DNS SRV resource
# records; if there are none, role checks if a local Postfix installation is
# present and uses the host FQDN as the SMTP (submission) server address.
# Finally, the static ``smtp.<domain>`` is used.
#
# Use of FQDN instead of ``localhost`` is required for X.509 certificate
# verification and for correct information in system logs.
roundcube__smtp_fqdn: '{{ (roundcube__smtp_srv_rr | selectattr("target", "defined")
                           | map(attribute="target")
                           | map("regex_replace", "\.$","")
                           | list | first)
                          if ("NXDOMAIN" not in roundcube__smtp_srv_rr and
                              roundcube__smtp_srv_rr[0])
                          else (ansible_fqdn
                                if (ansible_local|d() and ansible_local.postfix|d() and
                                    (ansible_local.postfix.installed|d())|bool)
                                else ("smtp." + roundcube__domain)) }}'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_port [[[
#
# SMTP port.
#
# SMTP port (default is 25; use 587 for STARTTLS or 465 for the
# deprecated SSL over SMTP (aka SMTPS))
roundcube__smtp_port: '{{ (roundcube__smtp_srv_rr | selectattr("target", "defined")
                           | map(attribute="port") | list | sort | first)
                          if ("NXDOMAIN" not in roundcube__smtp_srv_rr and
                              roundcube__smtp_srv_rr[0])
                          else "465" }}'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_server [[[
#
# SMTP server host (for sending mails).
#
# Enter hostname with prefix tls:// to use STARTTLS, or use
# prefix ssl:// to use the deprecated SSL over SMTP (aka SMTPS)
# Supported replacement variables:
# %h - user's IMAP hostname
# %n - hostname ($_SERVER['SERVER_NAME'])
# %t - hostname without the first part
# %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)
# %z - IMAP domain (IMAP hostname without the first part)
# For example %n = mail.domain.tld, %t = domain.tld
roundcube__smtp_server: '{{ ("ssl://"
                             if (roundcube__smtp_port == "465")
                             else ("tls://"
                                   if (roundcube__smtp_port == "587")
                                   else "tls://"))
                             + roundcube__smtp_fqdn }}'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_user [[[
#
# SMTP username (if required) if you use %u as the username Roundcube will
# use the current username for login.
roundcube__smtp_user: '%u'

                                                                   # ]]]
# .. envvar:: roundcube__smtp_pass [[[
#
# SMTP password (if required) if you use %p as the password Roundcube will
# use the current user's password for login.
roundcube__smtp_pass: '%p'

                                                                   # ]]]
# .. envvar:: roundcube__product_name [[[
#
#  Name your service. This is displayed on the login screen and in the window title
roundcube__product_name: 'Roundcube Webmail'

                                                                   # ]]]
# .. envvar:: roundcube__des_key [[[
#
# Encryption key for the users imap password which is stored in the session
# record (and the client cookie if remember password is enabled).
roundcube__des_key: '{{ lookup("password", secret + "/credentials/" + ansible_fqdn + "/roundcube/des_key chars=hexdigits length=24") }}'

                                                                   # ]]]
# .. envvar:: roundcube__username_domain [[[
#
# Specify a domain (realm) to add to usernames without a specified domain.
# Defining a default domain helps avoid creating separate RoundCube profiles
# when users use logins with and without a domain specified.
#
# The default is to create a domain based on the host DNS domain.
roundcube__username_domain: '%d'

                                                                   # ]]]
# .. envvar:: roundcube__log_driver [[[
#
# Define the log driver. Currently available: ``syslog``, ``stdout``, ``file``.
roundcube__log_driver: 'syslog'
                                                                   # ]]]
                                                                   # ]]]
# Roundcube configuration file [[[
# --------------------------------

# These variables define the contents of the :file:`config/config.inc.php`
# local configuration file. See :ref:`roundcube__ref_configuration` for more
# details.

# .. envvar:: roundcube__original_configuration [[[
#
# The list defines the Roundcube configuration options stored in the
# :file:`config.inc.php.sample` configuration file. Modifications to these
# configuration options should be done using the subsequent variables.
roundcube__original_configuration:

  - name: 'init_config'
    raw: |
      $config = array();
    section: 'init'

  - name: 'db_dsnw'
    comment: |
      Database connection string (DSN) for read+write operations
      Format (compatible with PEAR MDB2): db_provider://user:password@host/database
      Currently supported db_providers: mysql, pgsql, sqlite, mssql, sqlsrv, oracle
      For examples see http://pear.php.net/manual/en/package.database.mdb2.intro-dsn.php
      NOTE: for SQLite use absolute path (Linux): 'sqlite:////full/path/to/sqlite.db?mode=0646'
            or (Windows): 'sqlite:///C:/full/path/to/sqlite.db'
    value: 'mysql://roundcube:pass@localhost/roundcubemail'
    section: 'sql'

  - name: 'default_host'
    comment: |
      The IMAP host chosen to perform the log-in.
      Leave blank to show a textbox at login, give a list of hosts
      to display a pulldown menu or set one host as string.
      To use SSL/TLS connection, enter hostname with prefix ssl:// or tls://
      Supported replacement variables:
      %n - hostname ($_SERVER['SERVER_NAME'])
      %t - hostname without the first part
      %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)
      %s - domain name after the '@' from e-mail address provided at login screen
      For example %n = mail.domain.tld, %t = domain.tld
    value: 'localhost'
    section: 'imap'

  - name: 'smtp_server'
    comment: |
      SMTP server host (for sending mails).
      Enter hostname with prefix tls:// to use STARTTLS, or use
      prefix ssl:// to use the deprecated SSL over SMTP (aka SMTPS)
      Supported replacement variables:
      %h - user's IMAP hostname
      %n - hostname ($_SERVER['SERVER_NAME'])
      %t - hostname without the first part
      %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)
      %z - IMAP domain (IMAP hostname without the first part)
      For example %n = mail.domain.tld, %t = domain.tld
    value: 'localhost'
    section: 'smtp'

  - name: 'smtp_port'
    comment: |
      SMTP port (default is 25; use 587 for STARTTLS or 465 for the
      deprecated SSL over SMTP (aka SMTPS))
    value: 587
    section: 'smtp'

  - name: 'smtp_user'
    comment: |
      SMTP username (if required) if you use %u as the username Roundcube
      will use the current username for login
    value: '%u'
    section: 'smtp'

  - name: 'smtp_pass'
    comment: |
      SMTP password (if required) if you use %p as the password Roundcube
      will use the current user's password for login
    value: '%p'
    section: 'smtp'

  - name: 'support_url'
    comment: |
      Provide an URL where a user can get support for this Roundcube installation
      PLEASE DO NOT LINK TO THE ROUNDCUBE.NET WEBSITE HERE!
    value: ''
    section: 'system'

  - name: 'product_name'
    comment: |
      Name your service. This is displayed on the login screen and in the window title
    value: 'Roundcube Webmail'
    section: 'system'

  - name: 'des_key'
    comment: |
      this key is used to encrypt the users imap password which is stored
      in the session record (and the client cookie if remember password is enabled).
      please provide a string of exactly 24 chars.
      YOUR KEY MUST BE DIFFERENT THAN THE SAMPLE VALUE FOR SECURITY REASONS
    value: 'rcmail-!24ByteDESkey*Str'
    section: 'system'

  - name: 'plugins'
    comment: 'List of active plugins (in plugins/ directory)'
    value: [ 'archive', 'zipdownload' ]
    section: 'plugins'

  - name: 'skin'
    comment: 'Skin name: folder from skins/'
    value: 'elastic'
    section: 'userprefs'

                                                                   # ]]]
# .. envvar:: roundcube__default_configuration [[[
#
# This list defines Roundcube configuration options which are defined by the
# role and override the original configuration options.
roundcube__default_configuration:

  - name: 'db_dsnw'
    value: '{{ "sqlite:///" + roundcube__git_checkout + "/"
                            + roundcube__database_map[roundcube__database].dbname
                            + "?mode=640" }}'
    state: '{{ "present"
               if (roundcube__database_map[roundcube__database].dbtype == "sqlite")
               else "ignore" }}'

  - name: 'db_dsnw'
    value: '{{ "mysql://" + roundcube__database_map[roundcube__database].dbuser + ":"
                          + roundcube__database_map[roundcube__database].dbpass + "@"
                          + roundcube__database_map[roundcube__database].dbhost + "/"
                          + roundcube__database_map[roundcube__database].dbname }}'
    state: '{{ "present"
               if (roundcube__database_map[roundcube__database].dbtype == "mysql")
               else "ignore" }}'

  - name: 'log_driver'
    comment: |
      Log driver: "syslog", "stdout" or "file"
    value: '{{ roundcube__log_driver }}'

  - name: 'default_host'
    value: '{{ roundcube__imap_server }}'

  - name: 'default_port'
    comment: 'TCP port used for IMAP connections'
    value: '{{ roundcube__imap_port }}'
    value_cast: 'int'
    copy_id_from: 'default_host'

  - name: 'smtp_server'
    value: '{{ roundcube__smtp_server }}'

  - name: 'smtp_port'
    value: '{{ roundcube__smtp_port }}'
    value_cast: 'int'

  - name: 'smtp_user'
    value: '{{ roundcube__smtp_user }}'

  - name: 'smtp_pass'
    value: '{{ roundcube__smtp_pass }}'

  - name: 'product_name'
    value: '{{ roundcube__product_name }}'

  - name: 'des_key'
    value: '{{ roundcube__des_key }}'

  - name: 'username_domain'
    comment: |
      Automatically add this domain to user names for login
      Only for IMAP servers that require full e-mail addresses for login
      Specify an array with 'host' => 'domain' values to support multiple hosts
      Supported replacement variables:
      %h - user's IMAP hostname
      %n - hostname ($_SERVER['SERVER_NAME'])
      %t - hostname without the first part
      %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)
      %z - IMAP domain (IMAP hostname without the first part)
      For example %n = mail.domain.tld, %t = domain.tld
    value: '{{ roundcube__username_domain }}'

  - name: 'plugins'
    value: '{{ (roundcube__default_plugins
                + roundcube__plugins) | unique }}'

  - name: 'skin'
    value: '{{ roundcube__skin_folder }}'

  - name: 'skin_logo'
    comment: |
      Logo image replacement. Specifies location of the image as:
      - URL relative to the document root of this Roundcube installation
      - full URL with http:// or https:// prefix
      - URL relative to the current skin folder (when starts with a '/')

      An array can be used to specify different logos for specific template files
      The array key specifies the place(s) the logo should be applied to and
      is made up of (up to) 3 parts:
      - skin name prefix (always with colon, can be replaced with *)
      - template name (or * for all templates)
      - logo type - it is used for logos used on multiple templates the
        available types include '[favicon]' for favicon, '[print]' for logo on
        all print templates (e.g. messageprint, contactprint) and '[small]' for
        small screen logo in supported skins
    value: '{{ roundcube__skin_logo }}'
    copy_id_from: 'skin'

                                                                   # ]]]
# .. envvar:: roundcube__configuration [[[
#
# This list defines Roundcube configuration options which should be present on
# all hosts in the Ansible inventory.
roundcube__configuration: []

                                                                   # ]]]
# .. envvar:: roundcube__group_configuration [[[
#
# This list defines Roundcube configuration options which should be present on
# hosts in a specific Ansible inventory group.
roundcube__group_configuration: []

                                                                   # ]]]
# .. envvar:: roundcube__host_configuration [[[
#
# This list defines Roundcube configuration options which should be present on
# specific hosts in the Ansible inventory.
roundcube__host_configuration: []

                                                                   # ]]]
# .. envvar:: roundcube__combined_configuration [[[
#
# This variable combines all Roundcube configuration lists and is used in role
# tasks and templates.
roundcube__combined_configuration: '{{ roundcube__original_configuration
                                       + roundcube__default_configuration
                                       + roundcube__configuration
                                       + roundcube__group_configuration
                                       + roundcube__host_configuration }}'
                                                                   # ]]]
                                                                   # ]]]
# Configuration file sections [[[
# -------------------------------

# These variables define the sections in the Roundcube
# :file:`config/config.inc.php` configuration file. See
# :ref:`roundcube__ref_configuration_sections` for more details.

# .. envvar:: roundcube__default_configuration_sections [[[
#
# The list of the default configuration sections defined by the role.
roundcube__default_configuration_sections:

  - name: 'init'
    state: 'hidden'

  - name: 'sql'
    title: 'SQL DATABASE'

  - name: 'logging'
    title: 'LOGGING/DEBUGGING'

  - name: 'imap'

  - name: 'smtp'

  - name: 'ldap'

  - name: 'cache'
    title: 'CACHE(S)'

  - name: 'system'

  - name: 'plugins'

  - name: 'ui'
    title: 'USER INTERFACE'

  - name: 'addressbook'
    title: 'ADDRESSBOOK SETTINGS'

  - name: 'userprefs'
    title: 'USER PREFERENCES'

  - name: 'unknown'
    title: 'OTHER OPTIONS'

                                                                   # ]]]
# .. envvar:: roundcube__configuration_sections [[[
#
# List of configuration sections defined by the user.
roundcube__configuration_sections: []

                                                                   # ]]]
# .. envvar:: roundcube__combined_configuration_sections [[[
#
# Variable which combines all of the configuration section lists and is used in
# role tasks and templates.
roundcube__combined_configuration_sections: '{{ roundcube__default_configuration_sections
                                                + roundcube__configuration_sections }}'
                                                                   # ]]]
                                                                   # ]]]
# Plugins [[[
# -----------

# .. envvar:: roundcube__default_plugins [[[
#
# List of plugins shipped and enabled by default with Roundcube.
roundcube__default_plugins: [ 'archive', 'filesystem_attachments', 'jqueryui', 'zipdownload' ]

                                                                   # ]]]
# .. envvar:: roundcube__plugins [[[
#
# Additional Roundcube plugins to enable. Check the :file:`plugins/` folder for
# the plugins shipped by default.
roundcube__plugins: []
                                                                   # ]]]
                                                                   # ]]]
# Skins [[[
# -------------------

# .. envvar:: roundcube__skin_folder [[[
#
# skin name: folder from `/skins <https://github.com/roundcube/roundcubemail/tree/1.4.0/skins>`_
# Currently available:
#
# - classic
# - elastic [default] (mobile-ready, requires nodejs dependency, due to CSS-LESS syntax)
# - larry
#
roundcube__skin_folder: 'elastic'
                                                                   # ]]]
# .. envvar:: roundcube__skin_logo [[[
#
# Logo image replacement. Specifies location of the image as:
#
# - URL relative to the document root of this Roundcube installation
# - full URL with http:// or https:// prefix
# - URL relative to the current skin folder (when starts with a '/')
#
roundcube__skin_logo: null
                                                                   # ]]]
                                                                   # ]]]
# Other variables [[[
# -------------------

# .. envvar:: roundcube__max_file_size [[[
#
# Maximum upload size, in MB.
roundcube__max_file_size: '30'
                                                                   # ]]]
                                                                   # ]]]
# Role-dependent configuration [[[
# --------------------------------

# .. envvar:: roundcube__nginx__dependent_servers [[[
#
# :program:`nginx` server configuration managed by the debops.nginx_ role.
roundcube__nginx__dependent_servers:

  - name: '{{ roundcube__fqdn }}'
    filename: 'debops.roundcube'
    by_role: 'debops.roundcube'
    type: 'php'
    root: '{{ roundcube__git_checkout }}'
    webroot_create: False
    access_policy: '{{ roundcube__nginx_access_policy }}'
    index: 'index.php'

    options: |
      autoindex off;
      client_max_body_size {{ roundcube__max_file_size }}M;
      client_body_buffer_size 128k;

    location_list:
      - pattern: '/'
        options: |
          try_files $uri $uri/ @roundcube;

      - pattern: '@roundcube'
        options: |
          rewrite ^/favicon\.ico$ skins/{{ roundcube__skin_folder }}/images/favicon.ico last;

      - pattern: '~ ^/?(installer|[A-Z0-9]+$)'
        options: |
          deny all;

      - pattern: '~ ^/?(\.git|\.tx|SQL|bin|config|logs|temp|tests|program\/(include|lib|localization|steps))'
        options: |
          deny all;

      - pattern: '~ /(README\.md|composer\.json-dist|composer\.json|package\.xml|Dockerfile)$'
        options: |
          deny all;

    php_options: |
      fastcgi_intercept_errors        on;
      fastcgi_ignore_client_abort     off;
      fastcgi_connect_timeout         60;
      fastcgi_send_timeout            180;
      fastcgi_read_timeout            180;
      fastcgi_buffer_size             128k;
      fastcgi_buffers               4 256k;
      fastcgi_busy_buffers_size       256k;
      fastcgi_temp_file_write_size    256k;

    php_upstream: 'php_roundcube'

                                                                   # ]]]
# .. envvar:: roundcube__nginx_access_policy [[[
#
# Name of the "nginx access policy" for Roundcube webpage. See debops.nginx_
# Ansible role for more details.
roundcube__nginx_access_policy: ''

                                                                   # ]]]
# .. envvar:: roundcube__nginx__dependent_upstreams [[[
#
# PHP upstream server configuration managed by the debops.nginx_ role.
roundcube__nginx__dependent_upstreams:

  - name: 'php_roundcube'
    by_role: 'debops.roundcube'
    enabled: True
    type: 'php'
    php_pool: 'roundcube'

                                                                   # ]]]
# .. envvar:: roundcube__php__dependent_packages [[[
#
# List of PHP packages to install using the debops.php_ role.
roundcube__php__dependent_packages:
  - '{{ roundcube__base_php_packages }}'
  - '{{ roundcube__optional_php_packages }}'
  - '{{ roundcube__custom_php_packages }}'

                                                                   # ]]]
# .. envvar:: roundcube__php__dependent_pools [[[
#
# PHP pools managed by the debops.php_ role.
roundcube__php__dependent_pools:
  name: 'roundcube'
  by_role: 'debops.roundcube'
  user: '{{ roundcube__user }}'
  group: '{{ roundcube__group }}'

  php_values:
    ## https://secure.php.net/manual/en/info.configuration.php#ini.upload-max-filesize
    upload_max_filesize:        '{{ roundcube__max_file_size }}M'

    ## https://secure.php.net/manual/en/ini.core.php#ini.post-max-size
    post_max_size:              '{{ roundcube__max_file_size }}M'

    ## https://github.com/roundcube/roundcubemail/wiki/Install-Requirements
    file_uploads:               'on'
    mbstring.func_overload:     'off'
    memory_limit:               '64M'
    magic_quotes_runtime:       'off'
    magic_quotes_sybase:        'off'
    session.auto_start:         'off'
    suhosin.session.encrypt:    'off'
                                                                   # ]]]
# .. envvar:: roundcube__nodejs__npm_dependent_packages [[[
#
# Configuration for the :ref:`debops.nodejs` Ansible role.
roundcube__nodejs__npm_dependent_packages:
  # Dependency for the 'elastic' skin to compile the CSS files
  - 'less'
                                                                   # ]]]
                                                                   # ]]]
                                                                   # ]]]
