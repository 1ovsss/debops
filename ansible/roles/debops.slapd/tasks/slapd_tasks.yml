---

- name: Manage OpenLDAP entries
  ldap_entry:
    dn: '{{ item.dn }}'
    objectClass: '{{ item.objectClass }}'
    attributes: '{{ item.attributes | d(omit) }}'
    state: '{{ item.state }}'
  when: item.objectClass|d() and item.state not in [ 'init', 'ignore' ]
  no_log: '{{ item.no_log | d(False) }}'

- name: Manage OpenLDAP attributes
  ldap_attrs:
    dn: '{{ item.dn }}'
    attributes: '{{ item.attributes }}'
    state: '{{ item.state }}'
  when: not item.objectClass|d() and item.state not in [ 'init', 'ignore' ]
  no_log: '{{ item.no_log | d(False) }}'
